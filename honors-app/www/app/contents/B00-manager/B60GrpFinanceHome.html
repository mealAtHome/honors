<ons-page id="GFHM">

    <style>

    </style>

    <!-- ======================== -->
    <!-- 페이지용 타이틀 -->
    <!-- ======================== -->
    <ons-toolbar>
        <div class="left"><gg-backbtn onclick="GFHM.close(true);"></gg-backbtn></div>
        <div class="center">재무현황</div>
    </ons-toolbar>

    <!-- ========================= -->
    <!-- 탭 -->
    <!-- ========================= -->
    <div class="common-div-cushion">
        <table class="GFHM-tbl-common common-tbl-tab commonEvent-tbl-tab">
            <tbody>
                <tr>
                    <td class="GFHM-td-maintab" val="finance" tab="tab" >재무현황</td>
                    <td class="GFHM-td-maintab" val="reflect" tab=""    >일정현황</td>
                </tr>
            </tbody>
        </table>
    </div>
    <hr class="common-hr-paddingLR"/>

    <!-- ========================= -->
    <!-- 재무현황 -->
    <!-- ========================= -->
    <div class="GFHM-div-maintab" tab="finance" style="display:none;">
        <div class="common-div-cushion">
            <p class="common-p-title">재무현황</p>
            <ul class="common-ul-announce">
                <li>일정에서 정산과 구매내역을 종합한 결과입니다.</li>
                <li>일정의 재무반영여부는 "일정현황" 탭에서 지정하거나 각 일정상세에서 설정할 수 있습니다.</li>
            </ul>
        </div>
        <style>
            #GFHM-tbl-grpfinance { width:100%; }
            #GFHM-tbl-grpfinance > tbody > tr > th { text-align: left; white-space: nowrap; padding: 0.4em 0.6em; width:30%; }
            #GFHM-tbl-grpfinance > tbody > tr > td { text-align: left; white-space: nowrap; padding: 0.4em 0.6em; }

            #GFHM-tbl-grpfinance > tbody > tr > th:nth-child(1) { width:10%; white-space:nowrap;  }
            #GFHM-tbl-grpfinance > tbody > tr > td:nth-child(2) { width:80%; white-space:nowrap; border-right: none; }
            #GFHM-tbl-grpfinance > tbody > tr > td:nth-child(3) { width:10%; white-space:nowrap; border-left: none; }
        </style>
        <div class="common-div-cushion">
            <table id="GFHM-tbl-grpfinance" class="common-tbl-normal" tbl-type="normal">
                <tbody>
                    <tr>
                        <th><span>자본금</span></th>
                        <td id="GFHM-td-capitaltotal">0원</td>
                        <td><button id="GFHM-btn-capitaltotalDetail" class="common-btn-outline common-tag-fontsize09">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>찬조누적</span></th>
                        <td id="GFHM-td-totalSponsorship">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>구매누적</span></th>
                        <td id="GFHM-td-totalPurchase">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>손실누적</span></th>
                        <td id="GFHM-td-totalLoss">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>[일정]정산누적</span></th>
                        <td id="GFHM-td-totalSettlebill">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09" style="visibility: hidden;">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>[일정]미입금 총액</span></th>
                        <td id="GFHM-td-totalUnpaidNowAmount">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09" style="visibility: hidden;">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>[일정]미입금 손실</span></th>
                        <td id="GFHM-td-totalUnpaidLossAmount">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09" style="visibility: hidden;">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>[일정]구매누적</span></th>
                        <td id="GFHM-td-totalPurchasebill">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09" style="visibility: hidden;">상세</button></td>
                    </tr>
                    <tr>
                        <th><span>최종누적금액</span></th>
                        <td id="GFHM-td-netProfitbill">0원</td>
                        <td><button class="common-btn-outline common-tag-fontsize09" style="visibility: hidden;">상세</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ========================= -->
    <!-- 재무설정 (테이블, 재무반영여부설정가능) -->
    <!-- ========================= -->
    <div class="GFHM-div-maintab" tab="reflect" style="display:none;">
        <div class="common-div-cushion">
            <p class="common-p-title">재무설정</p>
            <ul class="common-ul-announce">
                <li>아래 테이블에서 재무반영여부를 지정할 수 있습니다.</li>
                <li>모임 내에서 공식일정만 재무에 반영하는 기능입니다.</li>
            </ul>
        </div>
        <div class="common-div-cushion">
            <div id="GFHM-div-clsListForFinanceReflect" class="common-tag-fontsize09"></div>
        </div>
    </div>

    <script>
        var GFHM =
        {
            code : "GFHM",
            Data: {},

            show()
            {
                /* validation param */
                if(GFHM.Data.grpno          == undefined) { Common.toast("잘못된 접근입니다."); GFHM.close(); return; }
                if(GFHM.Data.pagenoForCls   == undefined) { GFHM.Data.pagenoForCls = 1; }
                if(GFHM.Data.maintab        == undefined) { GFHM.Data.maintab = "finance"; }

                /* set tab */
                $(`.GFHM-td-maintab[val='${GFHM.Data.maintab}']`).click();
            },

            search()
            {
                Common.showProgress();
                setTimeout(function()
                {
                    Common.hideProgress();
                }, ajaxDelayTime);
            },


            /* ========================= */
            /* close */
            /* ========================= */
            close(force=false)
            {
                Navigation.moveBack();
            },
        }

        $(document).ready(function()
        {
            /* ========================= */
            /* event */
            /* ========================= */
            $("#GFHM-btn-capitaltotalDetail").click(function() { Navigation.moveFrontPage(Navigation.Page.B61GrpFinanceCapitalDetail, {grpno:GFHM.Data.grpno, } ); });

            $(".GFHM-td-maintab").click(function()
            {
                /* 선택된 탭 표시 */
                let maintab = $(this).attr("val");
                $(".GFHM-td-maintab").removeAttr("tab");
                $(this).attr("tab", "tab");

                /* save selected */
                GFHM.Data.maintab = maintab;

                /* process */
                Common.showProgress();
                setTimeout(function()
                {
                    try
                    {
                        /* var */
                        let grpno = GFHM.Data.grpno;
                        let pagenoForCls = GFHM.Data.pagenoForCls;

                        /* 탭별표시 */
                        switch(maintab)
                        {
                            case "finance":
                            {
                                /* reset html */
                                $("#GFHM-td-totalCapital").html("-");
                                $("#GFHM-td-totalSettlebill").html("-");
                                $("#GFHM-td-totalPurchasebill").html("-");
                                $("#GFHM-td-netProfitbill").html("-");

                                /* get finance info */
                                let mGrpformng = Api.Grpformng.selectByPk(grpno).getModel();
                                // if(mGrpformng != null)
                                // {
                                //     $("#GFHM-td-totalCapital").html(mGrpformng.getGrpfncCapitalWon());
                                //     $("#GFHM-td-totalSettlebill").html(mGrpformng.getGrpfncSalesWon());
                                //     $("#GFHM-td-totalPurchasebill").html(mGrpformng.getGrpfncPurchaseWon());
                                //     $("#GFHM-td-netProfitbill").html(mGrpformng.getGrpfncProfitWon());
                                // }
                                break;
                            }
                            case "reflect":
                            {
                                /* get list with pagenation */
                                let mClss = Api.Cls.selectByGrpnoForMng(grpno, pagenoForCls);
                                mClss.makeTableForFinanceReflect("#GFHM-div-clsListForFinanceReflect");
                                break;
                            }
                        }
                        /* show / hide */
                        $(".GFHM-div-maintab").hide();
                        $(`.GFHM-div-maintab[tab='${maintab}']`).show();
                    }
                    catch(e)
                    {
                        Common.catchProc(e);
                    }
                    Common.hideProgress();
                }, ajaxDelayTime);
            });


            /* ========================= */
            /* page process */
            /* ========================= */

            /* get data from Config */
            try
            {
                GFHM.Data = Navigation.getPageParam();
                Navigation.executeShow();
            }
            catch(e)
            {
                console.error(e);
                GFHM.close(true);
            }

        }); /* end function */

    </script>
</ons-page>