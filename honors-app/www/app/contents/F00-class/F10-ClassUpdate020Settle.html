<ons-page id="CUST">

    <style>
        #CUST-tbl-settle
        {
            white-space: nowrap;
        }
        #CUST-tbl-settle > tbody > tr > td:nth-child(1) { text-align: left; }
        #CUST-tbl-settle > tbody > tr > td:nth-child(2) { text-align: right; }
        #CUST-tbl-settle > tbody > tr > td:nth-child(3) { text-align: right; }
        #CUST-tbl-settle > tbody > tr > td[col="username"]          { text-align:left; }
        #CUST-tbl-settle > tbody > tr > td[col="billstand"]         { text-align:right; }
        #CUST-tbl-settle > tbody > tr > td[col="billfinal"]         { text-align:center; }
        #CUST-tbl-settle > tbody > tr > td[col="billadjustment"]    { text-align:center; }
        #CUST-tbl-settle > tbody > tr > td[col="billmemo"]          { text-align:center; }
        #CUST-tbl-settle > tbody > tr > td[col="memberpoint"]       { text-align:right; }
        #CUST-tbl-settle > tbody > tr > td[col="billpointed"]       { text-align:center; }
        #CUST-tbl-settle > tfoot > tr > td { text-align: right; }

        .CUST-input-billfinal         { font-size:1em; width: 6em; vertical-align: middle; text-align: right; }
        .CUST-input-billadjustment    { font-size:1em; width: 6em; vertical-align: middle; text-align: right; }
        .CUST-input-memberpoint       { font-size:1em; width: 6em; vertical-align: middle; text-align: right; }
        .CUST-input-billpointed       { font-size:1em; width: 6em; vertical-align: middle; text-align: right; }
        .CUST-input-billmemo          { font-size:1em; width: 8em; vertical-align: middle; text-align: left; }

    </style>

    <!-- ======================== -->
    <!-- í˜ì´ì§€ìš© íƒ€ì´í‹€ -->
    <!-- ======================== -->
    <ons-toolbar>
        <div class="left"><gg-backbtn onclick="CUST.close(true);"></gg-backbtn></div>
        <div class="center">ì •ì‚°</div>
    </ons-toolbar>

    <!-- ========================= -->
    <!-- ì¼ì •ìƒì„¸ -->
    <!-- ========================= -->
    <div class="common-div-cushion">
        <div class="common-tag-fontsize11" style="font-weight:bold;">
            <span class="common-tag-fontsize10">ì¼ì • : </span>
            <span class="common-tag-fontsize10" id="CUST-span-clstitle"></span>
        </div>
    </div>

    <!-- ----- -->
    <!-- ì„ íƒ íƒ­ -->
    <!-- ----- -->
    <div class="common-div-cushion">
        <table class="common-tbl-tab commonEvent-tbl-tab">
            <tbody>
                <tr>
                    <td class="CUST-td-maintab" tab-val="input"   tab="tab" >ì •ì‚°ì…ë ¥</td>
                    <td class="CUST-td-maintab" tab-val="history"  tab=""    >ì •ì‚°ì´ë ¥</td>
                </tr>
            </tbody>
        </table>
    </div>
    <hr class="common-hr-paddingLR"/>

    <!-- --------------- -->
    <!-- ì •ì‚°ì…ë ¥ -->
    <!-- --------------- -->
    <div class="CUST-div-maintab" tab="input">
        <div class="common-div-cushion">
            <p class="common-p-title">ì •ì‚°ì…ë ¥</p>
            <span class="common-tag-block common-tag-fontsize09">â€»ì°¸ê°€ìë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì²­êµ¬ê¸ˆì•¡ì„ ê³„ì‚°í•˜ëŠ” í…Œì´ë¸”ì…ë‹ˆë‹¤.</span>
            <span class="common-tag-block common-tag-fontsize09">â€»ì¢Œìš°ë¡œ ìŠ¤í¬ë¡¤ì„ ì›€ì§ì—¬ ì •ì‚°ì •ë³´ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
            <div class="common-div-cushionUD">
                <div class="common-tag-fontsize09">
                    <button id="CUST-btn-addSettleItem" class="common-btn-outline">ï¼‹ì°¸ê°€ìì¶”ê°€</button>
                    <button id="CUST-btn-saveSettle"    class="common-btn-outline">ğŸ’¿ì„ì‹œì €ì¥</button>
                    <button id="CUST-btn-resetSettle"   class="common-btn-outline">ğŸ”ƒì„ì‹œì €ì¥ì·¨ì†Œ</button>
                </div>
            </div>
            <div class="common-div-scrollX">
                <table id="CUST-tbl-settle" class="common-tbl-normal common-tag-fontsize09" tbl-type="rowborder">
                    <thead>
                        <tr>
                            <th colspan="2">ì²­êµ¬ìƒíƒœ</th>
                            <th>ì²­êµ¬ëŒ€ìƒ</th>
                            <th>ì²­êµ¬ìµœì¢…</th>
                            <th>ì²­êµ¬ê¸ˆì•¡</th>
                            <th>ì²­êµ¬ë³´ì •</th>
                            <th>ì”ì—¬ê¸ˆ</th>
                            <th>ì”ì—¬ê¸ˆì‚¬ìš©</th>
                            <th>ë¹„ê³ (ë³´ì •ì‚¬ìœ ë“±)</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3">í•©ê³„</td>
                            <td><span id="CUST-span-billfinalSummary"></span></td>
                            <td><span id="CUST-span-billstandSummary"></span></td>
                            <td><span id="CUST-span-billadjustmentSummary"></span></td>
                            <td>-</span></td>
                            <td><span id="CUST-span-billpointedSummary"></span></td>
                            <td>-</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- --------------- -->
    <!-- ì •ì‚°ì´ë ¥ -->
    <!-- --------------- -->
    <div class="CUST-div-maintab" tab="history" style="display:none;">
        <div class="common-div-cushion">
            <p class="common-p-title">ì •ì‚°ì´ë ¥</p>
            <span class="common-tag-block common-tag-fontsize09">â€»ì²« ì •ì‚°ì™„ë£Œ ì‹œ, ì´ë ¥ì€ ì €ì¥í•˜ì§€ ì•Šê³ , ì´í›„ ë³€ê²½ ì‹œì—ë§Œ ì €ì¥í•©ë‹ˆë‹¤.</span>
            <span class="common-tag-block common-tag-fontsize09">â€»í‘œì‹œë˜ëŠ” ë°ì´í„°ëŠ” ë³€ê²½ì§ì „ì˜ ë°ì´í„°ì…ë‹ˆë‹¤.</span>
            <div class="common-div-scrollX">
                <div id="CUST-div-settlehist" class="common-tag-fontsize09"></div>
            </div>
        </div>
    </div>


    <!-- ======================== -->
    <!-- footer -->
    <!-- ======================== -->
    <button id="CUST-btn-settleComplete" class="common-btn-footer">ì •ì‚°ì™„ë£Œ</button>
    <div class="common-div-cushionFooter"></div>

    <script>
        var CUST =
        {
            code : "CUST",

            /* ========================= */
            /*
                í˜ì´ì§€ ë°ì´í„°
            */
            /* ========================= */
            Data : {},

            show()
            {
                /* validation param */
                if(CUST.Data.clsno == undefined)   { Common.toast("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤."); CUST.close(); return; }
                if(CUST.Data.grpno == undefined)   { Common.toast("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤."); CUST.close(); return; }
                if(CUST.Data.maintab == undefined) { CUST.Data.maintab = "input"; }

                /* init */
                Common.showProgress();
                setTimeout(function()
                {
                    try
                    {
                        /* ì •ì‚°ì…ë ¥ */
                        CUST.resetSettle();

                        /* ì •ì‚°ì´ë ¥ */
                        let clsno = CUST.Data.clsno;
                        let grpno = CUST.Data.grpno;
                        let mClssettlehists = Api.Clssettlehist.selectByClsno(grpno, clsno);
                        mClssettlehists.makeTable("#CUST-div-settlehist");

                        /* íƒ­ í‘œì‹œ */
                        $(`.CUST-td-maintab[tab-val=${CUST.Data.maintab}]`).click();
                    }
                    catch(e)
                    {
                        Common.catchProc(e);
                    }
                    Common.hideProgress();
                }, ajaxDelayTime);
            },

            resetSettle()
            {
                /* get var */
                let clsno = CUST.Data.clsno;
                let grpno = CUST.Data.grpno;

                /* ----- */
                /* init */
                /* ----- */
                let mCls = Api.Cls.selectByPkForAll(grpno, clsno, GGF.none, GGF.toast);
                let clssettleflg = mCls.getClssettleflg();
                $("#CUST-span-clstitle").text(mCls.getClstitle());

                /* clear */
                $("#CUST-tbl-settle > tbody").empty();

                /* ----- */
                /* cls : ë¯¸ì •ì‚° */
                /* ----- */
                if(clssettleflg == GGF.Cls.Clssettleflg.YET)
                {
                    /* ì„ì‹œì €ì¥ë°ì´í„° */
                    let mClssettletmps = Api.Clssettletmp.selectByClsno(grpno, clsno);
                    let mClssettletmpModels = mClssettletmps.getModels();
                    for(let i in mClssettletmpModels)
                        CUST.addRowForSettleByClssettletmp(mClssettletmpModels[i]);

                    /* ì„ì‹œì €ì¥ë°ì´í„°ê°€ ì—†ìœ¼ë©´, ë¼ì¸ì—…ìœ¼ë¡œë¶€í„° ì‘ì„± */
                    if(mClssettletmpModels.length == 0)
                    {
                        let mClslineup2s = Api.Clslineup2.selectByClsnoForSettleForMng(grpno, clsno);
                        let lineups = mClslineup2s.getModels();
                        for(let i in lineups)
                            CUST.addRowForSettleByClslineup2(lineups[i]);
                    }
                }

                /* ----- */
                /* cls : ì •ì‚°ì™„ë£Œì‹œ, clssettle ì—ì„œ ì¡°íšŒ */
                /* ----- */
                if(clssettleflg == GGF.Cls.Clssettleflg.DONE)
                {
                    let mClssettles = Api.Clssettle.selectByClsnoForMng(grpno, clsno);
                    let mClssettleModels = mClssettles.getModels();
                    for(let i in mClssettleModels)
                        CUST.addRowForSettleByClssettle(mClssettleModels[i]);
                }

                /* event */
                CUST.setEventForSettle();
                CUST.calSummarySettle();
            },

            addRowForSettleByClssettletmp(model)
            {
                /* í–‰ì´ ì´ë¯¸ ì‚­ì œë˜ì—ˆëŠ”ì§€ */
                let isDeleted = model.getSettledeleteflg() == GGF.Y;
                let rowStatus = isDeleted ? "deleted" : "active";
                let display = isDeleted ? "display:none;" : "";

                let html =
                `
                    <tr userno="${model.getUserno()}" settle-status="temp" row-status="${rowStatus}" style="${display}">
                        <td col="status"                                                 >ì„ì‹œ</td>
                        <td col="btn"                                                    ><button class="CUST-btn-deleteRowForSettle common-btn-outline" btn-type="cancel" userno="${model.getUserno()}">ì‚­ì œ</button></td>
                        <td col="username"         userno="${model.getUserno()}"         >${model.getUsername()}</td>
                        <td col="billfinal"                                              ><input type="text"   class="common-input-text CUST-input-billfinal"        userno="${model.getUserno()}" value="${model.getBillstandardWon()}" subvalori="${model.getBillstandard()}" subval="${model.getBillstandard()}" disabled></td>
                        <td col="billstand"        subval="${model.getBillstandard()}"   >${model.getBillstandardWon()}</td>
                        <td col="billadjustment"                                         ><input type="number" class="common-input-text CUST-input-billadjustment"   userno="${model.getUserno()}" value="0"></td>
                        <td col="memberpoint"                                            ><input type="text"   class="common-input-text CUST-input-memberpoint"      userno="${model.getUserno()}" value="${model.getGrpmPointWon()}" subval="${model.getGrpmPoint()}" disabled></td>
                        <td col="billpointed"                                            ><input type="number" class="common-input-text CUST-input-billpointed"      userno="${model.getUserno()}" value="0"></td>
                        <td col="billmemo"                                               ><input type="text"   class="common-input-text CUST-input-billmemo"         userno="${model.getUserno()}" value=""></td>
                    </tr>
                `;
                $(`#CUST-tbl-settle > tbody`).append(html);
            },

            addRowForSettleByClssettle(model)
            {
                /* ë‚©ë¶€í™•ì •ì¼ ì‹œ, ë” ì´ìƒ ì²­êµ¬ê¸ˆì•¡ ë³€ê²½ ë¶ˆê°€ */
                let disabled = (model.isMemberdepositflgYes() || model.isManagerdepositflgYes()) ? "disabled" : "";
                let statusText = disabled ? "ì…ì™„" : "ë¯¸ì…";

                /* í–‰ ìƒì‚° */
                let html =
                `
                    <tr userno="${model.getUserno()}" settle-status="settled" row-status="active">
                        <td col="status"                                                >${statusText}</td>
                        <td col="btn"                                                   ><button class="CUST-btn-deleteRowForSettle common-btn-outline" btn-type="cancel" userno="${model.getUserno()}" ${disabled}>ì‚­ì œ</button></td>
                        <td col="username"         userno="${model.getUserno()}"        >${model.getUsername()}</td>
                        <td col="billfinal"                                             ><input type="text"   class="common-input-text CUST-input-billfinal"        userno="${model.getUserno()}" value="${model.getBillfinalWon()}" subvalori="${model.getBillfinal()}" subval="${model.getBillfinal()}" disabled></td>
                        <td col="billstand"        subval="${model.getBillstandard()}"  >${model.getBillstandardWon()}</td>
                        <td col="billadjustment"                                        ><input type="number" class="common-input-text CUST-input-billadjustment"   userno="${model.getUserno()}" value="${model.getBilladjustment()}" ${disabled}></td>
                        <td col="memberpoint"                                           ><input type="text"   class="common-input-text CUST-input-memberpoint"      userno="${model.getUserno()}" value="${model.getGrpmPointAfterSettleWon()}" subval="${model.getGrpmPointAfterSettle()}" disabled></td>
                        <td col="billpointed"                                           ><input type="number" class="common-input-text CUST-input-billpointed"      userno="${model.getUserno()}" value="${model.getBillpointed()}" ${disabled}></td>
                        <td col="billmemo"                                              ><input type="text"   class="common-input-text CUST-input-billmemo"         userno="${model.getUserno()}" value="${model.getBillmemo()}" ${disabled}></td>
                    </tr>
                `;
                $(`#CUST-tbl-settle > tbody`).append(html);
            },

            addRowForSettleByClslineup2(model)
            {
                let html =
                `
                    <tr userno="${model.getUserno()}" settle-status="temp" row-status="active">
                        <td col="status"                                            >ë“±ë¡</td>
                        <td col="btn"                                               ><button class="CUST-btn-deleteRowForSettle common-btn-outline" btn-type="cancel" userno="${model.getUserno()}">ì‚­ì œ</button></td>
                        <td col="username"         userno="${model.getUserno()}"    >${model.getUsername()}</td>
                        <td col="billfinal"                                         ><input type="text"   class="common-input-text CUST-input-billfinal"        userno="${model.getUserno()}" value="${model.getBillWon()}" subvalori="${model.getBill()}" subval="${model.getBill()}" disabled></td>
                        <td col="billstand"        subval="${model.getBill()}"      >${model.getBillWon()}</td>
                        <td col="billadjustment"                                    ><input type="number" class="common-input-text CUST-input-billadjustment"   userno="${model.getUserno()}" value="0"></td>
                        <td col="memberpoint"                                       ><input type="text"   class="common-input-text CUST-input-memberpoint"      userno="${model.getUserno()}" value="${model.getMemberpointWon()}" subval="${model.getMemberpoint()}" disabled></td>
                        <td col="billpointed"                                       ><input type="number" class="common-input-text CUST-input-billpointed"      userno="${model.getUserno()}" value="0"></td>
                        <td col="billmemo"                                          ><input type="text"   class="common-input-text CUST-input-billmemo"         userno="${model.getUserno()}" value=""></td>
                    </tr>
                `;
                $(`#CUST-tbl-settle > tbody`).append(html);
            },


            checkDuplicateSettleUser(userno)
            {
                let isDuplicate = false;
                $("#CUST-tbl-settle > tbody > tr").each(function()
                {
                    let existUserno = $(this).attr("userno");
                    if(existUserno == userno)
                        isDuplicate = true;
                });
                return isDuplicate;
            },

            calSummarySettle()
            {
                let billstandSummary = 0;
                let billfinalSummary = 0;
                let billadjustmentSummary = 0;
                let billpointedSummary = 0;

                /* í•©ê³„ */
                $("#CUST-tbl-settle > tbody > tr").each(function()
                {
                    let settleStatus    = $(this).attr("settle-status");
                    let rowStatus       = $(this).attr("row-status");
                    let billstand       = parseInt($(this).find("td[col=billstand]").attr("subval"));
                    let billfinal       = parseInt($(this).find("td[col=billfinal] > input").attr("subval"));
                    let billadjustment  = parseInt($(this).find("td[col=billadjustment] > input").val());
                    let billpointed     = parseInt($(this).find("td[col=billpointed] > input").val());

                    if(rowStatus == "deleted")
                        return;

                    if(isNaN(billstand)) return;
                    if(isNaN(billfinal)) return;
                    if(isNaN(billadjustment)) return;
                    if(isNaN(billpointed)) return;

                    billstandSummary += billstand;
                    billfinalSummary += billfinal;
                    billadjustmentSummary += billadjustment;
                    billpointedSummary += billpointed;
                });

                $("#CUST-span-billstandSummary").text(GGC.Common.priceWon(billstandSummary));
                $("#CUST-span-billfinalSummary").text(GGC.Common.priceWon(billfinalSummary));
                $("#CUST-span-billadjustmentSummary").text(GGC.Common.priceWon(billadjustmentSummary));
                $("#CUST-span-billpointedSummary").text(GGC.Common.priceWon(billpointedSummary));
            },

            setEventForSettle()
            {
                /* --------------- */
                /* settle : í–‰ì‚­ì œ */
                /* --------------- */
                $(".CUST-btn-deleteRowForSettle").off("click").on("click", function()
                {
                    let userno = $(this).attr("userno");
                    let process = function()
                    {
                        /* get settleStatus */
                        let settleStatus = $(`#CUST-tbl-settle > tbody > tr[userno=${userno}]`).attr("settle-status");
                        if(settleStatus == "temp")
                        {
                            $(`#CUST-tbl-settle > tbody > tr[userno=${userno}]`).remove();
                        }
                        else
                        {
                            $(`#CUST-tbl-settle > tbody > tr[userno=${userno}]`).attr("row-status", "deleted");
                            $(`#CUST-tbl-settle > tbody > tr[userno=${userno}]`).hide();
                        }
                        CUST.calSummarySettle();
                    }
                    Common.confirm2("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?", process);
                });

                /* --------------- */
                /* settle : ì²­êµ¬ë³´ì • */
                /* --------------- */
                $(".CUST-input-billadjustment").off("keyup").on("keyup", function()
                {
                    /* vars */
                    let userno              = $(this).attr("userno");
                    let billfinalEl         = $(`.CUST-input-billfinal[userno=${userno}]`);
                    let billadjustmentEl    = $(this);
                    let billpointedEl       = $(`.CUST-input-billpointed[userno=${userno}]`);
                    let billfinal           = parseInt(billfinalEl.attr("subval"));
                    let billfinalOri        = parseInt(billfinalEl.attr("subvalori"));
                    let billadjustment      = parseInt(billadjustmentEl.val());
                    let billpointed         = parseInt(billpointedEl.val());

                    /* validation */
                    if(isNaN(billadjustment))
                        return;

                    let result = billfinalOri + billadjustment - billpointed;
                    billfinalEl.attr("subval", result);
                    billfinalEl.val(GGC.Common.priceWon(result));
                    CUST.calSummarySettle();
                });

                /* --------------- */
                /* settle : ì”ì—¬ê¸ˆ */
                /* --------------- */
                $(".CUST-input-billpointed").off("keyup").on("keyup", function()
                {
                    let userno              = $(this).attr("userno");
                    let billfinalEl         = $(`.CUST-input-billfinal[userno=${userno}]`);
                    let billadjustmentEl    = $(`.CUST-input-billadjustment[userno=${userno}]`);
                    let billpointedEl       = $(this);
                    let billfinal           = parseInt(billfinalEl.attr("subval"));
                    let billfinalOri        = parseInt(billfinalEl.attr("subvalori"));
                    let billadjustment      = parseInt(billadjustmentEl.val());
                    let billpointed         = parseInt(billpointedEl.val());
                    let memberpoint         = parseInt($(`.CUST-input-memberpoint[userno=${userno}]`).attr("subval"));

                    if(isNaN(billpointed)) return;
                    if(billpointed > memberpoint) { Common.toast("ì”ì—¬ê¸ˆ ì‚¬ìš©ì•¡ì´ ì”ì—¬ê¸ˆë³´ë‹¤ ë§ìŠµë‹ˆë‹¤."); $(this).val(0); $(this).keyup(); return; }

                    let result = billfinalOri + billadjustment - billpointed;
                    billfinalEl.attr("subval", result);
                    billfinalEl.val(GGC.Common.priceWon(result));
                    CUST.calSummarySettle();
                });
                /* ì…ë ¥í•­ëª©ì´ ê³µë°±ì¼ ë•Œ */
                $(".CUST-input-billadjustment") .off("change").on("change", function() { if($(this).val() == "") $(this).val(0); $(this).keyup(); });
                $(".CUST-input-billpointed")    .off("change").on("change", function() { if($(this).val() == "") $(this).val(0); $(this).keyup(); });
            },

            /* ========================= */
            /* ì •ì‚°ì •ë³´ìˆ˜ì§‘ */
            /* ========================= */
            getArrForSettle()
            {
                let arr = [];
                $("#CUST-tbl-settle > tbody > tr").each(function()
                {
                    let userno              = $(this).attr("userno");
                    let rowStatus           = $(this).attr("row-status");
                    let billstand           = parseInt($(this).find("td[col=billstand]").attr("subval"));
                    let billfinal           = parseInt($(this).find("td[col=billfinal] > input").attr("subval"));
                    let billadjustment      = parseInt($(this).find("td[col=billadjustment] > input").val());
                    let billpointed         = parseInt($(this).find("td[col=billpointed] > input").val());
                    let billmemo            = $(this).find("td[col=billmemo] > input").val();
                    let dat =
                    {
                        USERNO          : userno,
                        ROW_STATUS      : rowStatus,
                        BILLSTANDARD    : billstand,
                        BILLADJUSTMENT  : billadjustment,
                        BILLPOINTED     : billpointed,
                        BILLFINAL       : billfinal,
                        BILLMEMO        : billmemo,
                    }
                    arr.push(dat);
                });
                return arr;
            },

            /* ========================= */
            /* close */
            /* ========================= */
            close(force=false)
            {
                if(force == true)
                {
                    Navigation.moveBack();
                    return;
                }
                Common.confirmClose();
            },
        }

        $(document).ready(function()
        {
            /* ========================= */
            /* event */
            /* ========================= */


            /* =============== */
            /* íƒ­ */
            /* =============== */
            $(".CUST-td-maintab").click(function()
            {
                /* ì„ íƒëœ íƒ­ í‘œì‹œ */
                let val = $(this).attr("tab-val");
                CUST.Data.maintab = val;

                /* íƒ­ë³„ í‘œì‹œ */
                $(".CUST-div-maintab").hide();
                $(`.CUST-div-maintab[tab=${val}]`).show();
            });

            /* =============== */
            /* settle : ì°¸ê°€ìì¶”ê°€ */
            /* =============== */
            $("#CUST-btn-addSettleItem").click(function()
            {
                /* ëŒì•„ì™”ì„ ë•Œ, show ë°©ì§€ */
                CUST.Data.executeShowWhenClose = false;

                /* ë‹¤ì´ì–¼ë¡œê·¸ */
                let grpno = CUST.Data.grpno;
                let clsno = CUST.Data.clsno;
                let teamname = "for-settle";
                let data =
                {
                    option : "F10ClassUpdate020Settle-addSettleUser",
                    grpno : grpno,
                    clsno : clsno,
                    teamname : teamname,
                    regmember : GGF.Y,
                }
                Navigation.moveFrontDialog(Navigation.Page.S10ChooseGrpMember, data);
            });

            /* =============== */
            /* settle : ì„ì‹œì €ì¥ */
            /* =============== */
            $("#CUST-btn-saveSettle").click(function()
            {
                Common.showProgress();
                setTimeout(function()
                {
                    try
                    {
                        let clsno = CUST.Data.clsno;
                        let grpno = CUST.Data.grpno;
                        let arr = CUST.getArrForSettle();
                        let mApiResponse = Api.Clssettletmp.insertByArr(grpno, clsno, JSON.stringify(arr), GGF.toast, GGF.toast);
                    }
                    catch(e)
                    {
                        Common.catchProc(e);
                    }
                    Common.hideProgress();
                }, ajaxDelayTime);
            });

            /* =============== */
            /* settle : ì„ì‹œì €ì¥ì‚­ì œ */
            /* =============== */
            $("#CUST-btn-resetSettle").click(function()
            {
                let process = function()
                {
                    Common.showProgress();
                    setTimeout(function()
                    {
                        try
                        {
                            let clsno = CUST.Data.clsno;
                            let grpno = CUST.Data.grpno;

                            /* ì‚­ì œ */
                            let mApiResponse = Api.Clssettletmp.deleteByClsno(grpno, clsno, GGF.toast, GGF.toast);
                            if(mApiResponse.isSuccess())
                                CUST.resetSettle();
                        }
                        catch(e)
                        {
                            Common.catchProc(e);
                        }
                        Common.hideProgress();
                    }, ajaxDelayTime);
                }
                Common.confirm2("ì„ì‹œë¡œ ì €ì¥í•œ ë°ì´í„°ê°€ ì‚­ì œë˜ë©°, ê¸°ì¡´ ë°ì´í„°ì—ëŠ” ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤. ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", process);
            });

            /* =============== */
            /* ì €ì¥ */
            /* =============== */
            $("#CUST-btn-settleComplete").click(function()
            {
                let process = function()
                {
                    Common.showProgress();
                    setTimeout(function()
                    {
                        try
                        {
                            /* vars */
                            let clsno = CUST.Data.clsno;
                            let grpno = CUST.Data.grpno;
                            let arrForSettle = CUST.getArrForSettle();

                            /* validation */
                            /* ìµœì¢…ì²­êµ¬ê¸ˆì•¡ì´ 0 ë¯¸ë§Œì¸ í–‰ì´ ìˆëŠ”ê°€ */
                            for(let i in arrForSettle)
                            {
                                let dat = arrForSettle[i];
                                if(dat.BILLFINAL < 0)
                                {
                                    Common.toast("ìµœì¢…ì²­êµ¬ê¸ˆì•¡ì´ 0ì› ë¯¸ë§Œì¸ ì°¸ê°€ìê°€ ìˆìŠµë‹ˆë‹¤. ì²­êµ¬ê¸ˆì•¡ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
                                    Common.hideProgress();
                                    return;
                                }
                            }

                            /* api */
                            let mApiResponse = Api.Cls.updateClssettleflgDone(grpno, clsno, JSON.stringify(arrForSettle), GGF.toast, GGF.toast);
                            if(mApiResponse.isSuccess())
                                Navigation.executeShow();
                        }
                        catch(e)
                        {
                            Common.catchProc(e);
                        }
                        Common.hideProgress();
                    }, ajaxDelayTime);
                }
                Common.confirm2("ì •ì‚°ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì¶”í›„ì— ìˆ˜ì •ê°€ëŠ¥í•©ë‹ˆë‹¤.", process);
            });


            /* ========================= */
            /* page process */
            /* ========================= */

            /* get data from Config */
            try
            {
                CUST.Data = Navigation.getPageParam();
                Navigation.executeShow();
            }
            catch(e)
            {
                console.error(e);
                CUST.close(true);
            }

            /* localizing */
            /* $("#CUST").i18n(); */

        }); /* end function */

    </script>
</ons-page>