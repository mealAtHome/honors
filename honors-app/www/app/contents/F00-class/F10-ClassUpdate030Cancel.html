<ons-page id="CUCC">

    <!-- ======================== -->
    <!-- 페이지용 타이틀 -->
    <!-- ======================== -->
    <ons-toolbar>
        <div class="left"><gg-backbtn onclick="CUCC.close(true);"></gg-backbtn></div>
        <div class="center">일정취소</div>
    </ons-toolbar>

    <!-- ========================= -->
    <!-- 일정상세 -->
    <!-- ========================= -->
    <div class="common-div-cushion">
        <p class="common-p-title">
            <span id="CUCC-span-clstitle"></span>
        </p>
        <table class="common-tbl-vertical common-tag-cushionUp common-tag-fontsize09" tbl-type="normal">
            <tbody>
                <tr><th>모임시간</th><td><span id="CUCC-span-clsdt"></span></td></tr>
                <tr><th>모집일정</th><td><span id="CUCC-span-clsapplydt"></span></td></tr>
                <tr><th>집합장소</th><td><span id="CUCC-span-clsgroundaddr"></span> (<span id="CUCC-span-clsground"></span>)</td></tr>
                <tr><th>참가비</th><td><span id="CUCC-span-clsapplybill"></span></td></tr>
                <tr><th>상세</th><td><span id="CUCC-span-clscontent"></span></td></tr>
                <tr>
                    <th>담당자</th>
                    <td>
                        <div class="common-tag-block">작성자 : <span id="CUCC-span-clsusernoregname"></span></div>
                        <div class="common-tag-block">주관(정) : <span id="CUCC-span-clsusernoadmname"></span></div>
                        <div class="common-tag-block">주관(부) : <span id="CUCC-span-clsusernosubname"></span></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- ========================= -->
    <!-- 일정취소 -->
    <!-- ========================= -->
    <div class="common-div-formChild">
        <div class="common-div-formField">
            <span>취소사유</span>
            <span>[필수] 50글자 이내</span>
            <textarea id="CUDE-textarea-clscancelreason" type="text" class="common-textarea-field" rows="4"></textarea>
        </div>

        <!-- 다음으로 -->
        <table class="common-tbl-slideformFooterBtn" tbl-type="button1">
            <tbody>
                <tr>
                    <td><button id="CUDE-btn-clscancel" class="common-btn-inline" btn-type="cancel">일정취소</button></td>
                </tr>
            </tbody>
        </table>
    </div>


    <script>
        var CUCC =
        {
            code : "CUCC",
            Data : {},
            isManager : false,

            show()
            {
                /* validation param */
                if(CUCC.Data.clsno == undefined) { Common.toast("잘못된 접근입니다."); CUCC.close(); return; }
                if(CUCC.Data.grpno == undefined) { Common.toast("잘못된 접근입니다."); CUCC.close(); return; }

                /* init */
                Common.showProgress();
                setTimeout(function()
                {
                    try
                    {
                        /* get var */
                        let clsno = CUCC.Data.clsno;
                        let grpno = CUCC.Data.grpno;

                        /* 기본정보 */
                        let mCls = Api.Cls.selectByPkForAll(grpno, clsno, GGF.none, GGF.toast);
                        $("#CUCC-span-clstitle")            .text(mCls.getClstitle());
                        $("#CUCC-span-clsdt")               .text(mCls.getClsPeriod());
                        $("#CUCC-span-clsground")           .text(mCls.getClsground());
                        $("#CUCC-span-clsgroundaddr")       .text(mCls.getClsgroundaddr());
                        $("#CUCC-span-clsapplybill")        .text(mCls.getClsapplybillpriceWon());
                        $("#CUCC-span-clsapplydt")          .text(mCls.getClsapplyPeriod());
                        $("#CUCC-span-clscontent")          .text(mCls.getClscontent());
                        $("#CUCC-span-clsusernoregname")    .text(mCls.getClsusernoregname());
                        $("#CUCC-span-clsusernoadmname")    .text(mCls.getClsusernoadmname());
                        $("#CUCC-span-clsusernosubname")    .text(mCls.getClsusernosubname());
                        $(`.CUCC-div-clssub[tab=${mCls.getClstype()}]`).show();
                        $(`.CUCC-div-clssub[tab!=${mCls.getClstype()}]`).hide();
                    }
                    catch(e)
                    {
                        Common.catchProc(e);
                    }
                    Common.hideProgress();
                }, ajaxDelayTime);
            },

            /* ========================= */
            /* close */
            /* ========================= */
            close(force=false)
            {
                if(force == true)
                {
                    Navigation.moveBack();
                    return;
                }
                Navigation.moveBack();
            },
        }

        $(document).ready(function()
        {
            /* ========================= */
            /* event */
            /* ========================= */

            /* =============== */
            /* 저장 */
            /* =============== */
            $("#CUDE-btn-clscancel").click(function()
            {
                /* set var */
                let clsno = CUCC.Data.clsno;
                let grpno = CUCC.Data.grpno;
                let clscancelreason = $("#CUDE-textarea-clscancelreason").val().trim();

                /* input check */
                if(clscancelreason == "") { Common.toastError("취소사유를 입력해주세요."); return; }
                if(clscancelreason.length > 50) { Common.toastError("취소사유는 50글자 이내로 입력해주세요."); return; }

                /* process */
                let process = function()
                {
                    Common.showProgress();
                    setTimeout(function()
                    {
                        let mApiResponse = Api.Cls.updateClsstatusToCancel(grpno, clsno, clscancelreason, GGF.none, GGF.toast);
                        if(mApiResponse.isSuccess())
                        {
                            Common.toastSuccess("일정이 취소되었습니다.");
                            CUCC.close();
                            return;
                        }
                        Common.hideProgress();
                    }, ajaxDelayTime);
                };
                Common.confirm2("일정을 취소하시겠습니까?", process);
            });


            /* ========================= */
            /* page process */
            /* ========================= */

            /* get data from Config */
            try
            {
                CUCC.Data = Navigation.getPageParam();
                Navigation.executeShow();
            }
            catch(e)
            {
                console.error(e);
                CUCC.close(true);
            }

            /* localizing */
            /* $("#CUCC").i18n(); */

        }); /* end function */

    </script>
</ons-page>